import"./style.a87c9e06.js";function f(t){try{return t.fields.filter(e=>e.tooltip.indexOf("Issue type")!=-1).map(e=>e.value)[0]}catch{console.log("Impossible de r\xE9cup\xE9rer le Jira"),console.log(t)}}function c(t){try{return t.fields.filter(e=>e.tooltip.indexOf("GOJIRA KEY")!=-1).map(e=>e.value)[0]}catch{console.log("Impossible de r\xE9cup\xE9rer le Jira"),console.log(t)}}function d(t){const e=t.fields.filter(r=>r.tooltip.indexOf("GOJIRA KEY")!=-1);return e.length?e[0].value.replace(/-.*/,""):""}const u=t=>t.type==="card",p=t=>{const e=r=>{try{const n=parseFloat(r.value);return isNaN(n)?null:n}catch{return null}};return t.fields.map(r=>({key:d(t),value:e(r)})).filter(r=>r.value)};async function g(t){const e=(await miro.board.getSelection()).filter(o=>o.type==="card"&&o.fields),r=[...new Set(e.map(o=>f(o)).filter(o=>o))],n=[...new Set(e.map(o=>c(o)).filter(o=>o))],i={},s=[];return e.forEach(o=>{const a=p(o);if(a.length===0){s.push(o);return}a.forEach(l=>{i[l.key]=(i[l.key]||0)+l.value})}),{jiras:r,costs:i,warn:s.length?`${s.length} co\xFBts inconnus`:"",unknowCosts:s,gojiras:n}}async function m(){miro.board.ui.on("selection:update",async t=>{if(t.items.filter(u).length<=1)return;const{jiras:r,costs:n,warn:i}=await g(t.items),s=Object.values(n).length===1?n[Object.keys(n)[0]]:JSON.stringify(n).replace(/{|}|"/g,"").replaceAll(",","<br/>");console.log(s),console.log(i),miro.board.notifications.showInfo("Co\xFBt total : "+s+"<br/>"+i)})}async function h(){miro.board.ui.on("icon:click",async()=>{const t=(await miro.board.getSelection()).filter(u);t.map(e=>c(e)).filter(e=>e).forEach(e=>{const r=e.startsWith("EPL-")?`https://gojira-out.enedis.fr/browse/${e}`:`https://gojira.enedis.fr/browse/${e}`;window.open(r,e)}),t.length===0&&await miro.board.ui.openPanel({url:"app.html"})})}console.log("CHARGEMENT GOJIRA LINK.....................");m();h();
