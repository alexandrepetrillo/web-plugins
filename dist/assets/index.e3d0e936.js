import"./style.a87c9e06.js";function u(t){try{return t.fields.filter(e=>e.tooltip.indexOf("Issue type")!=-1).map(e=>e.value)[0]}catch{console.log("Impossible de r\xE9cup\xE9rer le Jira"),console.log(t)}}function c(t){try{return t.fields.filter(e=>e.tooltip.indexOf("GOJIRA KEY")!=-1).map(e=>e.value)[0]}catch{console.log("Impossible de r\xE9cup\xE9rer le Jira"),console.log(t)}}function f(t){const e=t.fields.filter(r=>r.tooltip.indexOf("GOJIRA KEY")!=-1);return e.length?e[0].value.replace(/-.*/,""):""}const p=t=>t.type==="card"&&t.fields.some(e=>e.tooltip.indexOf("GOJIRA KEY")>-1),d=t=>{const e=r=>{try{const i=parseFloat(r.value);return isNaN(i)?null:i}catch{return null}};return t.fields.map(r=>({key:f(t),value:e(r)})).filter(r=>r.value)};async function g(t){const e=(await miro.board.getSelection()).filter(o=>o.type==="card"&&o.fields),r=[...new Set(e.map(o=>u(o)).filter(o=>o))],i=[...new Set(e.map(o=>c(o)).filter(o=>o))],s={},n=[];return e.forEach(o=>{const l=d(o);if(l.length===0){n.push(o);return}l.forEach(a=>{s[a.key]=(s[a.key]||0)+a.value})}),{jiras:r,costs:s,warn:n.length?`${n.length} co\xFBts inconnus`:"",unknowCosts:n,gojiras:i}}async function m(){miro.board.ui.on("selection:update",async t=>{if(t.items.filter(p).map(o=>o.fields.filter(l=>l.tooltip==="[SIX] GOJIRA KEY")[0].value).length<=1)return;const{jiras:r,costs:i,warn:s}=await g(t.items),n=Object.values(i).length===1?i[Object.keys(i)[0]]:JSON.stringify(i).replace(/{|}|"/g,"").replaceAll(",","<br/>");console.log(n),console.log(s),miro.board.notifications.showInfo("Co\xFBt total : "+n+"<br/>"+s)})}async function h(){miro.board.ui.on("icon:click",async()=>{const t=await miro.board.getSelection();t.map(e=>c(e)).filter(e=>e).forEach(e=>{const r=e.startsWith("EPL-")?`https://gojira-out.enedis.fr/browse/${e}`:`https://gojira.enedis.fr/browse/${e}`;window.open(r,e)}),t.length===0&&await miro.board.ui.openPanel({url:"app.html"})})}m();h();
